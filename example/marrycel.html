<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>i-select 控件学习</title>
    <meta name="description" content="">
    <meta name="keywords" content="">
    <link rel="stylesheet" href="../plugins/styles/iview.css">
    <link rel="stylesheet" href="../plugins/uikit-2.25.0/css/uikit.min.css">
    <script type="application/javascript" src="../plugins/vue.js"></script>
    <script type="application/javascript" src="../plugins/iview.js"></script>
    <script type="application/javascript" src="../plugins/jquery-3.3.1.min.js"></script>
    <script type="application/javascript" src="../plugins/uikit-2.25.0/js/uikit.min.js"></script>

</head>

<body>
<div id="_header">
    <div id="upMenu">
        <template>
            <i-menu mode="horizontal" :theme="theme1" active-name="1">
                <menu-item name="1">
                    <Icon type="ios-paper"></Icon>
                    内容管理
                </menu-item>
                <menu-item name="2">
                    <Icon type="ios-people"></Icon>
                    用户管理
                </menu-item>
                <Submenu name="3">
                    <template slot="title">
                        <Icon type="stats-bars"></Icon>
                        统计分析
                    </template>
                    <menu-group title="使用">
                        <menu-item name="3-1">新增和启动</menu-item>
                        <menu-item name="3-2">活跃分析</menu-item>
                        <menu-item name="3-3">时段分析</menu-item>
                    </menu-group>
                    <menu-group title="留存">
                        <menu-item name="3-4">用户留存</menu-item>
                        <menu-item name="3-5">流失用户</menu-item>
                    </menu-group>
                </Submenu>
                <menu-item name="4">
                    <Icon type="settings"></Icon>
                    综合设置
                </menu-item>
            </i-menu>
        </template>
    </div>
</div>
<div class="uk-grid uk-grid-small" id="_middle">

    <div class="uk-width-2-10" id="_left">
        <div id="leftMenu">
            <template>
                <br>
                <i-menu :theme="theme2" width="auto">
                    <Submenu name="1">
                        <template slot="title">
                            <Icon type="ios-paper"></Icon>
                            内容管理
                        </template>
                        <menu-item name="1-1">文章管理</menu-item>
                        <menu-item name="1-2">评论管理</menu-item>
                        <menu-item name="1-3">举报管理</menu-item>
                    </Submenu>
                    <Submenu name="2">
                        <template slot="title">
                            <Icon type="ios-people"></Icon>
                            用户管理
                        </template>
                        <menu-item name="2-1">新增用户</menu-item>
                        <menu-item name="2-2">活跃用户</menu-item>
                    </Submenu>
                    <Submenu name="3">
                        <template slot="title">
                            <Icon type="stats-bars"></Icon>
                            统计分析
                        </template>
                        <menu-group title="使用">
                            <menu-item name="3-1">新增和启动</menu-item>
                            <menu-item name="3-2">活跃分析</menu-item>
                            <menu-item name="3-3">时段分析</menu-item>
                        </menu-group>
                        <menu-group title="留存">
                            <menu-item name="3-4">用户留存</menu-item>
                            <menu-item name="3-5">流失用户</menu-item>
                        </menu-group>
                    </Submenu>
                </i-menu>
            </template>


        </div>
    </div>
    <div class="uk-width-8-10" id="_right">
        <div id="app" class="uk-panel-box" style="background-color: #FFFFFF;">
            <template>
                <br>
                <Card>
                    <p slot="title">The standard card</p>
                    <div>
                        <i-table border :columns="columns1" :data="data1" size="small" id="_target"></i-table>
                    </div>
                </Card>

            </template>
        </div>
    </div>
</div>
<div id="_"></div>

<script type="application/javascript">
    let upMenu = new Vue({
        el: '#upMenu',
        data: {
            theme1: 'dark'
        }

    });
    let leftMenu = new Vue({
        el: '#leftMenu',
        data: {
            theme2: 'light'
        }
    });
    let app = new Vue({
        el: '#app',
        data: {
            columns1: [{
                title: 'Code',
                key: 'code'
            },
                {
                    title: 'Name',
                    key: 'name'
                },
                {
                    title: 'Age',
                    key: 'age'
                },
                {
                    title: 'Address',
                    key: 'address'
                },
                {
                    title: 'Date',
                    key: 'date'
                }
            ],
            data1: [{
                code: 'NB2390888765433',
                name: 'John Brown',
                age: 18,
                address: 'New York No. 1 Lake Park',
                date: '2016-10-03'
            },
                {
                    code: 'NB2390888765433',
                    name: 'Jim Green',
                    age: 24,
                    address: 'London No. 1 Lake Park',
                    date: '2016-10-01'
                },
                {
                    code: 'NB2390888765433',
                    name: 'Joe Black',
                    age: 30,
                    address: 'Sydney No. 1 Lake Park',
                    date: '2016-10-02'
                },
                {
                    code: 'NB2390888765433',
                    name: 'Jon Snow',
                    age: 26,
                    address: 'Ottawa No. 2 Lake Park',
                    date: '2016-10-04'
                }
            ]
        },
        methods: {},
        mounted: function () {
            this.$nextTick(function () {
                console.log('----------------[[[ mounted ]]]-----------------');
                console.log($('#_target').length);
            })
        },
        updated: function () {
            this.$nextTick(function () {
                console.log('----------------[[[ updated ]]]-----------------');
                console.log($('#_target').length);
                console.log($('#_target').find('.ivu-table-body').find('table').length);
                let jqTarget = $('#_target').find('.ivu-table-body').find('table');
                // 这里写成了一个jquery插件的形式
                jqTarget.mergeCell({
                    // 目前只有cols这么一个配置项, 用数组表示列的索引,从0开始
                    // 然后根据指定列来处理(合并)相同内容单元格
                    cols: [0, 3]
                });
            })
        }
    });
    app.data1 = [{
        code: 'NB2390888765433',
        name: 'John Brown',
        age: 18,
        address: 'New York No. 1 Lake Park',
        date: '2016-10-03'
    },
        {
            code: 'NB2390888765433',
            name: 'Jim Green',
            age: 24,
            address: 'London No. 1 Lake Park',
            date: '2016-10-01'
        },
        {
            code: 'NB23908887654331',
            name: 'Joe Black',
            age: 30,
            address: 'Sydney No. 1 Lake Park',
            date: '2016-10-02'
        },
        {
            code: 'NB23908887654331',
            name: 'Jon Snow',
            age: 26,
            address: 'Ottawa No. 2 Lake Park',
            date: '2016-10-04'
        },
        {
            code: 'NB23908887654332',
            name: 'Joe Black',
            age: 30,
            address: 'Sydney No. 1 Lake Park',
            date: '2016-10-02'
        },
        {
            code: 'NB23908887654333',
            name: 'Jon Snow',
            age: 26,
            address: 'Ottawa No. 2 Lake Park',
            date: '2016-10-04'
        },
        {
            code: 'NB23908887654333',
            name: 'Joe Black',
            age: 30,
            address: 'Sydney No. 1 Lake Park',
            date: '2016-10-02'
        },
        {
            code: 'NB23908887654334',
            name: 'Jon Snow',
            age: 26,
            address: 'Ottawa No. 2 Lake Park',
            date: '2016-10-04'
        }
    ];
    // 剽窃他人的jquery方式实现合并单元格效果的插件
    ;(function ($) {
        // 看过jquery源码就可以发现$.fn就是$.prototype, 只是为了兼容早期版本的插件
        // 才保留了jQuery.prototype这个形式
        $.fn.mergeCell = function (options) {
            return this.each(function () {
                var cols = options.cols;
                for (var i = cols.length - 1; cols[i] != undefined; i--) {
                    // fixbug console调试
                    // console.debug(cols[i]);
                    mergeCell($(this), cols[i]);
                }
                dispose($(this));
            });
        };
        // 如果对javascript的closure和scope概念比较清楚, 这是个插件内部使用的private方法
        // 具体可以参考本人前一篇随笔里介绍的那本书
        function mergeCell($table, colIndex) {
            $table.data('col-content', ''); // 存放单元格内容
            $table.data('col-rowspan', 1); // 存放计算的rowspan值 默认为1
            $table.data('col-td', $()); // 存放发现的第一个与前一行比较结果不同td(jQuery封装过的), 默认一个"空"的jquery对象
            $table.data('trNum', $('tbody tr', $table).length); // 要处理表格的总行数, 用于最后一行做特殊处理时进行判断之用
            // 我们对每一行数据进行"扫面"处理 关键是定位col-td, 和其对应的rowspan
            $('tbody tr', $table).each(function (index) {
                // td:eq中的colIndex即列索引
                var $td = $('td:eq(' + colIndex + ')', this);
                // 取出单元格的当前内容
                var currentContent = $td.html();
                // 第一次时走此分支
                if ($table.data('col-content') == '') {
                    $table.data('col-content', currentContent);
                    $table.data('col-td', $td);
                } else {
                    // 上一行与当前行内容相同
                    if ($table.data('col-content') == currentContent) {
                        // 上一行与当前行内容相同则col-rowspan累加, 保存新值
                        var rowspan = $table.data('col-rowspan') + 1;
                        $table.data('col-rowspan', rowspan);
                        // 值得注意的是 如果用了$td.remove()就会对其他列的处理造成影响
                        $td.hide();
                        // 最后一行的情况比较特殊一点
                        // 比如最后2行 td中的内容是一样的, 那么到最后一行就应该把此时的col-td里保存的td设置rowspan
                        if (++index == $table.data('trNum'))
                            $table.data('col-td').attr('rowspan', $table.data('col-rowspan'));
                    } else { // 上一行与当前行内容不同
                        // col-rowspan默认为1, 如果统计出的col-rowspan没有变化, 不处理
                        if ($table.data('col-rowspan') != 1) {
                            $table.data('col-td').attr('rowspan', $table.data('col-rowspan'));
                        }
                        // 保存第一次出现不同内容的td, 和其内容, 重置col-rowspan
                        $table.data('col-td', $td);
                        $table.data('col-content', $td.html());
                        $table.data('col-rowspan', 1);
                    }
                }
            });
        }

        // 同样是个private函数 清理内存之用
        function dispose($table) {
            $table.removeData();
        }
    })(jQuery);
</script>
<script type="application/javascript" charset="UTF-8">
</script>
</body>

</html>